#!/bin/sh

sim=false

usage()
{
echo "Usage: $1 filename"
echo "  useful prompt for extracting archives"
echo ""
echo "Supports: gzip, bzip2, xz, zip"
}

if [ $# -eq 0 ] ; then
  usage $0
  exit 0
fi

while [ $# -gt 0 ] ; do
  parm="$1"
  shift

  case "$parm" in
    -h)
    usage $0
    exit 0
    ;;
    -s)
    sim=true
    ;;
    -*)
    echo "Unrecognized option: $input"
    usage $0
    exit 1
    ;;
    *)
    file=$parm
    break
    ;;
  esac
done

mimetype=`xdg-mime query filetype $file`
out=`dirname \`pwd\`/$file`

case $mimetype in
  application/x-gzip|application/x-bzip2|application/x-xz)
    list_com="tar -tvf $file"
    extract_com="tar -xf $file -C"
    break
  ;;
  application/zip)
    list_com="unzip -l $file"
    extract_com="unzip $file -d"
    break
  ;;
  *)
    echo "Unrecognized filetype: $mimetype"
    usage $0
    exit 1
  ;;
esac

$list_com

read -e -p "Ouput dir: " -i $out input
out=${input:-$out}
if ! $sim ; then
  if ! $extract_com $out ; then
    exit 1
  fi
fi

read -e -p "Open folder (Y/n)? " -i "Y" open_folder
if [ $open_folder != "n" ] ; then
  urxvt -cd $out &
  sleep 1
  exit 0
fi
